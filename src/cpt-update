#!/bin/sh -ef
# Check for updates

# shellcheck disable=1091
if command -v cpt-lib >/dev/null; then . cpt-lib; else . ./cpt-lib; fi

eval set -- "$(getopt -l no-fetch,download,root:,help,version,no-prompt -- yndhv "$@")"
while :; do
    case "$1" in
        --help|-h)
            out "usage: ${0##*/} [options]" "" \
                "  Options:" \
                "    -d --download     Only download updatable packages" \
                "    -n --no-fetch     Do not refresh the repositories" \
                "    -y --no-prompt    Do not prompt for confirmation" \
                "    --root [rootdir]  Use an alternate root directory" ""
            exit 1
            ;;
        --version|-v) version ;;
        -d|--download) export download_only=1; shift ;;
        -n|--no-fetch) export CPT_FETCH=0; shift     ;;
        -y|--no-prompt) CPT_PROMPT=0; shift          ;;
        --root) export CPT_ROOT=$2; shift 2          ;;
        --) shift; break ;;
    esac
done

create_cache

pkg_updates
